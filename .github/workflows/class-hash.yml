name: Check class hashes

on:
  pull_request:
    branches:
    - main
  push:
    branches:
    - main

jobs:
  check_class_hashes:
    name: Check class hashes
    runs-on: ubuntu-latest
    steps:
    - uses: software-mansion/setup-scarb@v1
      id: setup_scarb
      with:
        scarb-version: "2.4.4"
    - uses: actions/checkout@v3
    - uses: ericnordelo/setup-class-hash@v1
      with:
        version: "0.1.0"
    - name: Get class hashes
      id: get_class_hash
      run: class_hash get --json > class_hashes.json
    - uses: ./.github/actions/check-docsite-class-hashes
      with:
        compiler-version: ${{ steps.setup_scarb.outputs.scarb-version }}
        json-file: class_hashes.json
