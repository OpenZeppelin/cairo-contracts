= ERC4626

:eip20: https://eips.ethereum.org/EIPS/eip-20[EIP-20]
:eip4626: https://eips.ethereum.org/EIPS/eip-4626[EIP-4626]

{eip4626} is an extension of {eip20} that proposes a standard interface for token vaults.
This standard interface can be used by widely different contracts (including lending markets, aggregators, and intrinsically interest-bearing tokens), which brings a number of subtleties.
Navigating these potential issues is essential to implementing a compliant and composable token vault.

== Security Concern

In exchange for the assets deposited into an ERC-4626 vault, a user receives shares.
These shares can later be burned to redeem the corresponding underlying assets.
The number of shares a user gets depends on the amount of assets they put in and on the exchange rate of the vault.
This exchange rate is defined by the current liquidity held by the vault.

- If a vault has 100 tokens to back 200 shares, then each share is worth 0.5 assets.
- If a vault has 200 tokens to back 100 shares, then each share is worth 2.0 assets.

In other words, the exchange rate can be defined as the slope of the line that passes through the origin and the current number of assets and shares in the vault.
Deposits and withdrawals move the vault in this line.

image::erc4626-rate-linear.png[Exchange rates in linear scale]

=== Visualizing the Vault

=== The Attack

=== Defending with a Virtual Offset

== Usage

=== Custom Behavior: Adding Fees

== Interface

The following interface represents the full ABI of the Contracts for Cairo ERC4626Component.
The interface includes the both the {ierc20-interface} and {ierc20metadata-interface}.
Note that implementing the IERC20Metadata interface is a requirement of IERC4626.

[,cairo]
----
#[starknet::interface]
pub trait ERC4626ABI {
    // IERC4626
    fn asset() -> ContractAddress;
    fn total_assets() -> u256;
    fn convert_to_shares(assets: u256) -> u256;
    fn convert_to_assets(shares: u256) -> u256;
    fn max_deposit(receiver: ContractAddress) -> u256;
    fn preview_deposit(assets: u256) -> u256;
    fn deposit(assets: u256, receiver: ContractAddress) -> u256;
    fn max_mint(receiver: ContractAddress) -> u256;
    fn preview_mint(shares: u256) -> u256;
    fn mint(shares: u256, receiver: ContractAddress) -> u256;
    fn max_withdraw(owner: ContractAddress) -> u256;
    fn preview_withdraw(assets: u256) -> u256;
    fn withdraw(
        assets: u256, receiver: ContractAddress, owner: ContractAddress,
    ) -> u256;
    fn max_redeem(owner: ContractAddress) -> u256;
    fn preview_redeem(shares: u256) -> u256;
    fn redeem(
        shares: u256, receiver: ContractAddress, owner: ContractAddress,
    ) -> u256;

    // IERC20
    fn total_supply() -> u256;
    fn balance_of(account: ContractAddress) -> u256;
    fn allowance(owner: ContractAddress, spender: ContractAddress) -> u256;
    fn transfer(recipient: ContractAddress, amount: u256) -> bool;
    fn transfer_from(
        sender: ContractAddress, recipient: ContractAddress, amount: u256,
    ) -> bool;
    fn approve(spender: ContractAddress, amount: u256) -> bool;

    // IERC20Metadata
    fn name() -> ByteArray;
    fn symbol() -> ByteArray;
    fn decimals() -> u8;

    // IERC20CamelOnly
    fn totalSupply() -> u256;
    fn balanceOf(account: ContractAddress) -> u256;
    fn transferFrom(
        sender: ContractAddress, recipient: ContractAddress, amount: u256,
    ) -> bool;
}
----
